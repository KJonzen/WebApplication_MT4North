<p class=" text-black mb-3">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. </p>

<div class="row mr-4">
  <table class="table ml-3 m-0" id="t01" style="border-collapse:collapse;border-bottom: 1px solid lightgray">

    <!-- TABLE HEADER (PHASES) -->
    <thead class="thead-dark">
      <tr>
        <th scope="col" class="im-header im-header-first border-top-0" style=" border-radius: 6px 0 0 0;border-bottom: 1px solid white; margin-bottom: -1px;">
        </th>
        <ng-container *ngFor="let phase of phases | enumToArray">
          <th scope="col" class="im-header border-top-0 im-left-border triangle" style="border-left: 1px solid white;border-bottom: 1px solid white;" data-toggle="tooltip" title="Klicka för att markera/avmarkera">{{phase}}</th>
        </ng-container>
      </tr>
    </thead>

    <tbody>
      <!-- THEME ROWS -->
      <ng-container *ngFor="let theme of themes; let i = index">

        <!-- MAIN ROW -->
        <tr data-toggle="collapse" [attr.data-target]="'#collapsedRow'+i" aria-expanded="false" class="accordion-toggle parent im-theme-{{i}}" id="parent-{{i}}" title="Klicka för att expandera/kollapsa">
          <!-- FIRST COLUMN (THEME NAME) -->
          <td class="im-theme noselect align-middle">
            <span class="fa-stack fa-2x float-left im-theme-icon">
              <i class="fa fa-circle fa-stack-2x float-left im-theme-{{i}}"></i>
              <i class="fa fa-cog fa-stack-1x fa-inverse float-left"></i>
            </span><span class="align-middle im-theme-text ml-2">{{theme.name}}</span>
          </td>

          <!-- PROGRESS BARS -->
          <ng-container *ngFor="let phase of phases | enumToArray; let l = index">
            <td colspan="1" class="align-middle d-none d-md-table-cell">
              <div class="progress">
                <div id="row{{i}}col{{l}}-progress" class="im-theme-{{i}}" [class]="containsOngoingAcitvities(theme, phase) ? 'progress-bar progress-bar-striped' : 'progress-bar'" [style.width]="getProgress(theme, phase) + '%'" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
            </td>
          </ng-container>
        </tr>

        <!-- SECONDARY (COLLAPSABLE) ROW -->
        <tr class="child-parent-{{i}} sticky im-theme-{{i}} exlude-from-sortable">
          <td colspan="12" class="hiddenRow">
            <div class="accordion-body collapse container-fluid pl-0 pr-0" id="collapsedRow{{i}}">
              <table class="table borderless im-inner-table im-theme-{{i}}">
                <tbody>
                  <tr class="exlude-from-sortable">
                    <td class="col-xs-1 im-inner-col im-inner-col-first d-none d-md-table-cell">
                    </td>

                    <!-- ACTIVITES -->
                    <ng-container *ngFor="let phase of phases | enumToArray; let j = index">
                      <td class="col-xs-1 im-cell im-inner-col">
                        <div *ngFor="let activity of (theme.activities | matchesPhase: phase); let k = index" class="panel-group" id="accordion-r{{i}}c{{j}}-{{k}}">
                          <div class="panel panel-default">
                            <div class="panel-heading">
                              <h3 class="panel-title">
                                <a class="im-checkbox collapsed im-theme-{{i}}" [class.excluded]="activity.isExcluded" id="checkbox-r{{i}}c{{j}}-{{k}}" data-toggle="collapse" [attr.data-parent]="'#accordion-r'+i+'c'+j+'-'+k" href="#collapse-r{{i}}c{{j}}-{{k}}">
                                  <label>
                                    <!--<input [attr.data-parent]="'#row'+i+'col'+i+'-progress'" type="checkbox" value="10">-->
                                    <input type="checkbox" [indeterminate]="activity.status === 'crossed'" name="input-r{{i}}c{{j}}-{{k}}" (click)="$event.stopPropagation()" [ngModel]="activity.status === 'checked'" (ngModelChange)="checkStatus(activity)" [attr.data-parent]="'#row'+i+'col'+i+'-progress'" [disabled]="activity.isExcluded">
                                    {{activity.name}}
                                  </label>
                                </a>
                              </h3>
                            </div>
                            <div id="collapse-r{{i}}c{{j}}-{{k}}" class="panel-collapse collapse in">
                              <div class="panel-body im-theme-{{i}}">
                                <label>
                                  Deadline:
                                  <input type="date" class="w-100" id="test" />
                                </label>
                                <p class="mb-2 p-0">
                                  {{activity.description}}
                                </p>
                                <!--<a class="btn p-0"><p>Visa alternativ</p></a>-->
                                <hr class="m-0 pb-1" />
                                <div>
                                  <a class="btn p-0 im-theme-{{i}}" data-toggle="modal" [attr.data-target]="'#notesModal-r'+i+'c'+j+'-'+k">
                                    <p>
                                      <i class="fa fa-pen-square fa-fw"></i><span class="ml-1">Visa anteckningar</span>
                                    </p>
                                  </a>

                                  <!-- Modal -->
                                  <div class="modal fade" [attr.id]="'notesModal-r'+i+'c'+j+'-'+k" tabindex="-1" role="dialog" [attr.aria-labelledby]="'notesModalLabel-r'+i+'c'+j+'-'+k" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                      <div class="modal-content">
                                        <div class="modal-header">
                                          <h5 class="modal-title" id="notesModalLabel-r{{i}}c{{j}}-{{k}}">
                                            Anteckningar
                                            <br />
                                            <small>{{activity.name}}</small>
                                          </h5>
                                          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                          </button>
                                        </div>
                                        <div class="modal-body">
                                          <div class="card im-theme-{{i}}">
                                            <h6 class="card-header mt-0 mb-0 pt-1 pb-1">
                                              <small class="align-middle"><span class="mr-4">2020-01-01</span><span><i>Tillagd av: </i></span><span>Test Testsson</span><a class="btn p-0 align-middle float-right" data-toggle="tooltip" data-placement="bottom" title="Ta bort anteckning"><i class="fa fa-trash-alt"></i></a></small>
                                            </h6>
                                            <div class="card-body">
                                              <p class="card-text">Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris.</p>
                                            </div>
                                          </div>
                                          <form ngNativeValidate class="form-group mt-2" id="noteForm-r{{i}}c{{j}}-{{k}}">
                                            <label for="note-text-r{{i}}c{{j}}-{{k}}" class="col-form-label">Ny anteckning:</label>
                                            <textarea class="form-control" id="note-text-r{{i}}c{{j}}-{{k}}" maxlength="250" required></textarea>
                                            <input type="submit" class="btn btn-primary mt-2 float-right" value="Lägg till" />
                                          </form>
                                        </div>
                                        <!--
                                        <div class="modal-footer">
                                          <button type="button" class="btn btn-secondary" data-dismiss="modal">Stäng</button>
                                        </div>
                                          -->
                                      </div>
                                    </div>
                                  </div>

                                </div>
                                <div>
                                  <a class="btn p-0 im-theme-{{i}}" (click)="toggleActivityIsExcluded(activity)">
                                    <p>
                                      <i class="fa fa-fw" [ngClass]="(activity.isExcluded == true) ? 'fa-eye-slash' : 'fa-eye'"></i><span class="ml-1">{{ activity.isExcluded == true ? 'Inkludera' : 'Exkludera' }}</span>
                                    </p>
                                  </a>
                                </div>

                              </div>
                            </div>
                          </div>
                        </div>
                      </td>
                    </ng-container>

                  </tr>
                </tbody>
              </table>
            </div>
          </td>

      </ng-container>
    </tbody>
  </table>
</div>
